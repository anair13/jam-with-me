<p id="notice"><%= notice %></p>

<p>
  <b>Firebase identifier:</b>
  <%= @song.firebase_identifier %>
</p>


<%= link_to 'Edit', edit_song_path(@song) %> |
<%= link_to 'Back', songs_path %>

<script type="text/javascript">

var context = new AudioContext();

window.onload = init;
var context;
var bufferLoader;

function init() {
  // Fix up prefixing
  window.AudioContext = window.AudioContext || window.webkitAudioContext;
  context = new AudioContext();

  bufferLoader = new BufferLoader(
    context,
    [
      "http://localhost:3000/assets/c4.wav",
    ],
    finishedLoading
    );

  bufferLoader.load();
}

function finishedLoading(bufferList) {
  var source = context.createBufferSource();
  source.buffer = bufferList[0];
  source.connect(context.destination);

  playTone(source, 2);
}

function playTone(source, semitones) {
  var semitoneRatio = Math.pow(2, 1/12);
  source.playbackRate.value = Math.pow(semitoneRatio, semitones);
  source.start(0);
}

</script>